# ğŸ—ï¸ æ˜å°‚ãƒˆãƒ©ãƒ³ãƒ— (Mei-Tra) - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¾ã§ã®å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ”— å…¨ä½“ã®ä¾å­˜é–¢ä¿‚ã®æ–¹å‘ (Clean Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¤–å´ (Infrastructure)                        â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Frontend (Presentation Layer)                         â”‚  â”‚
â”‚  â”‚         ãƒ»Pages, Components, Hooks                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    WebSocket/REST Client (Communication Layer)               â”‚  â”‚
â”‚  â”‚    ãƒ»Socket.IO Client, HTTP Client                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Gateways/Controllers (Infrastructure/Presentation Layer)  â”‚  â”‚
â”‚  â”‚    ãƒ»GameGateway, SocialGateway, UserProfileController       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Use Cases (Application Layer)                       â”‚  â”‚
â”‚  â”‚           ãƒ»JoinRoomUseCase, PlayCardUseCase                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             Services (Domain Layer)                           â”‚  â”‚
â”‚  â”‚             ãƒ»RoomService, CardService, ChatService           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Repository Interfaces (Domain Layer)                    â”‚  â”‚
â”‚  â”‚      ãƒ»IRoomRepository, IChatRoomRepository                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–²                                     â”‚
â”‚                                â”‚  ä¾å­˜æ€§ã®é€†è»¢                       â”‚
â”‚                                â”‚  (Dependency Inversion)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Repository Implementations (Infrastructure Layer)           â”‚  â”‚
â”‚  â”‚  ãƒ»SupabaseRoomRepository, SupabaseChatRoomRepository        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Database (External Services Layer)                    â”‚  â”‚
â”‚  â”‚         ãƒ»Supabase PostgreSQL                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚                         å†…å´ (Domain)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¾å­˜ã®æ–¹å‘: å¤–å´ â†’ å†…å´
å†…å´ã®å±¤ã¯å¤–å´ã‚’çŸ¥ã‚‰ãªã„ (Clean Architectureã®åŸå‰‡)
```

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸŒ Frontend (Presentation Layer)                        â”‚
â”‚                    Next.js / Vercel ã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ”Œ WebSocket/REST (Communication Layer)                     â”‚
â”‚            Socket.IO Client / Axios - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæ–¹å‘é€šä¿¡           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸš€ Backend (Infrastructure/Application/Domain Layers)            â”‚
â”‚         NestJS / Fly.io ã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ—„ï¸ Database (External Services Layer)                        â”‚
â”‚  Supabase PostgreSQL (é–‹ç™º: Local Docker / æœ¬ç•ª: Cloud Supabase)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Frontend Layer è©³ç´° (Next.js App Router)

### Presentation Layer (ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ“± Presentation Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Pages (app/[locale]/page.tsx)                                  â”‚    â”‚
â”‚  â”‚  - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°                                                   â”‚    â”‚
â”‚  â”‚  - SSR/SSG                                                       â”‚    â”‚
â”‚  â”‚  - å›½éš›åŒ– (i18n)                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Components (components/)                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ organisms/  (è¤‡åˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ molecules/  (ä¸­é–“ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ GameTable/  (ã‚²ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ PlayerHand/ (æ‰‹æœ­è¡¨ç¤º)                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ ScoreBoard/ (ã‚¹ã‚³ã‚¢è¡¨ç¤º)                                     â”‚    â”‚
â”‚  â”‚  â””â”€ social/     (ãƒãƒ£ãƒƒãƒˆ UI)                                   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°: SCSS Modules (.module.scss)                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- UIè¡¨ç¤ºã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å—ã‘ä»˜ã‘
- SCSS Modulesã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- Atomic Designãƒ‘ã‚¿ãƒ¼ãƒ³ (organisms/molecules)

### State Management Layer (çŠ¶æ…‹ç®¡ç†å±¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ”„ State Management Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Custom Hooks (hooks/)                                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ useSocket.ts      (Socket.IOæ¥ç¶šç®¡ç†)                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ useGame.ts        (ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†)                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ useRoom.ts        (ãƒ«ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†)                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ useSocialSocket.ts (ãƒãƒ£ãƒƒãƒˆSocketç®¡ç†)                      â”‚    â”‚
â”‚  â”‚  â””â”€ useAuth.ts        (èªè¨¼çŠ¶æ…‹ç®¡ç†)                             â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  å½¹å‰²: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ + Socket ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Context Providers (contexts/)                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ AuthContext.tsx        (Supabaseèªè¨¼ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹)         â”‚    â”‚
â”‚  â”‚  â””â”€ SocialSocketContext.tsx (ãƒãƒ£ãƒƒãƒˆç”¨Socketå…±æœ‰)              â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  å½¹å‰²: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹å…±æœ‰                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç®¡ç† (React state)
- WebSocketã‚¤ãƒ™ãƒ³ãƒˆã®è³¼èª­ã¨ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã®å…±æœ‰ (Context API)

### Communication Layer (é€šä¿¡å±¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ”Œ Communication Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Socket.IO Client (app/socket.ts)                                â”‚    â”‚
â”‚  â”‚  â”œâ”€ getSocket()     (ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ Socket å–å¾—)                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ reconnectSocket() (å†æ¥ç¶šå‡¦ç†)                               â”‚    â”‚
â”‚  â”‚  â””â”€ disconnectSocket() (åˆ‡æ–­å‡¦ç†)                                â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  2ã¤ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹:                                             â”‚    â”‚
â”‚  â”‚  ãƒ»/ (GameGateway)     - ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯                          â”‚    â”‚
â”‚  â”‚  ãƒ»/social (SocialGateway) - ãƒãƒ£ãƒƒãƒˆ                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  REST API Client (app/api/)                                      â”‚    â”‚
â”‚  â”‚  â””â”€ /api/user-profile/{id}/avatar (ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  ä½¿ç”¨ä¾‹: å¤§å®¹é‡ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç† (Socket.IO)
- REST APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ç”¨)
- å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯

## ğŸš€ Backend Layer è©³ç´° (NestJS + Clean Architecture)

### Infrastructure/Presentation Layer (ã‚¤ãƒ³ãƒ•ãƒ©/ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ Infrastructure/Presentation Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  WebSocket Gateways (*.gateway.ts)                                â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  GameGateway            â”‚  SocialGateway                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  namespace: /           â”‚  namespace: /social               â”‚  â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»create-room           â”‚ ãƒ»chat:join-room                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»join-room             â”‚ ãƒ»chat:leave-room                 â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»start-game            â”‚ ãƒ»chat:post-message               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»declare-blow          â”‚ ãƒ»chat:typing                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»play-card             â”‚ ãƒ»chat:list-messages              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ ãƒ»reconnection å‡¦ç†     â”‚                                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  å½¹å‰²: ãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç† (WebSocket ã‚¤ãƒ™ãƒ³ãƒˆâ†’Use Cases ã¸å§”è­²)       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  REST Controllers (*.controller.ts)                               â”‚    â”‚
â”‚  â”‚  â””â”€ UserProfileController                                         â”‚    â”‚
â”‚  â”‚     â”œâ”€ POST /:id/avatar (ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ + Sharp.js æœ€é©åŒ–)     â”‚    â”‚
â”‚  â”‚     â””â”€ GET  /:id (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—)                              â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  å½¹å‰²: REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (å¤§å®¹é‡ãƒã‚¤ãƒŠãƒªå°‚ç”¨)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç† (Socket.IOã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡)
- REST HTTPãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç†
- Use Casesã¸ã®å‡¦ç†å§”è­²
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€ä¿¡

### Application Layer (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ - Use Cases)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ’¼ Application Layer (Use Cases)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Use Cases (use-cases/*.use-case.ts)                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ JoinRoomUseCase         (ãƒ«ãƒ¼ãƒ å‚åŠ ãƒ­ã‚¸ãƒƒã‚¯)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ CreateRoomUseCase       (ãƒ«ãƒ¼ãƒ ä½œæˆãƒ­ã‚¸ãƒƒã‚¯)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ StartGameUseCase        (ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ­ã‚¸ãƒƒã‚¯)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ DeclareBlowUseCase      (Blowå®£è¨€ãƒ­ã‚¸ãƒƒã‚¯)                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ PlayCardUseCase         (ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ã‚¤ãƒ­ã‚¸ãƒƒã‚¯)                â”‚    â”‚
â”‚  â”‚  â””â”€ ...                                                            â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  ç‰¹å¾´:                                                             â”‚    â”‚
â”‚  â”‚  ãƒ»@Injectable() ã§NestJS DIã«ç™»éŒ²                                 â”‚    â”‚
â”‚  â”‚  ãƒ»è¤‡æ•°Serviceã‚’çµ„ã¿åˆã‚ã›ãŸå‡¦ç†ãƒ•ãƒ­ãƒ¼                            â”‚    â”‚
â”‚  â”‚  ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«                            â”‚    â”‚
â”‚  â”‚  ãƒ»å…¥åŠ›æ¤œè¨¼ + ãƒ¦ãƒ¼ã‚¶ãƒ¼æ­£è¦åŒ– + ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«æº–å‚™                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
- è¤‡æ•°ã®Domain Servicesã®èª¿æ•´
- å…¥åŠ›æ¤œè¨¼ã¨ãƒ‡ãƒ¼ã‚¿å¤‰æ›
- Gatewayå‘ã‘ã‚¤ãƒ™ãƒ³ãƒˆã®æº–å‚™

**ä¾‹: JoinRoomUseCase**
```typescript
@Injectable()
export class JoinRoomUseCase implements IJoinRoomUseCase {
  constructor(
    @Inject('IRoomService') private readonly roomService: IRoomService,
  ) {}

  async execute(request: JoinRoomRequest): Promise<JoinRoomResponse> {
    // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ­£è¦åŒ– (èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ vs ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼)
    const normalizedUser = this.normalizeUser(user, authenticatedUser);

    // 2. ãƒ«ãƒ¼ãƒ å‚åŠ å‡¦ç†
    const joinSucceeded = await this.roomService.joinRoom(roomId, normalizedUser);

    // 3. ã‚²ãƒ¼ãƒ å†é–‹åˆ¤å®š
    const resumePayload = await this.buildResumePayloadIfNeeded(roomId, room);

    return { success: true, data: { room, resumePayload } };
  }
}
```

### Domain Layer (ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ - Services)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ§  Domain Layer (Services)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Domain Services (services/*.service.ts)                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ GameStateService     (ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†)                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ RoomService          (ãƒ«ãƒ¼ãƒ ç®¡ç†)                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ CardService          (ã‚«ãƒ¼ãƒ‰é…å¸ƒãƒ»ç®¡ç†)                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ BlowService          (Blowãƒ•ã‚§ãƒ¼ã‚ºãƒ­ã‚¸ãƒƒã‚¯)                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ PlayService          (Playãƒ•ã‚§ãƒ¼ã‚ºãƒ­ã‚¸ãƒƒã‚¯)                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ ScoreService         (ã‚¹ã‚³ã‚¢è¨ˆç®—)                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ ChatService          (ãƒãƒ£ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯)                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ ChatCleanupService   (æœŸé™åˆ‡ã‚Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤)                 â”‚    â”‚
â”‚  â”‚  â””â”€ AuthService          (èªè¨¼ãƒ»èªå¯)                             â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  å½¹å‰²: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ (ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« (ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«)
- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ“ä½œ
- ç´”ç²‹ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
- ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«ä¾å­˜ã—ãªã„

### Infrastructure Layer - Data Access (ã‚¤ãƒ³ãƒ•ãƒ©å±¤ - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ğŸ“¦ Infrastructure Layer (Repositories)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Repository Interfaces (repositories/interfaces/)                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ IRoomRepository           (ãƒ«ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹)              â”‚    â”‚
â”‚  â”‚  â”œâ”€ IGameStateRepository      (ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ°¸ç¶šåŒ–)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ IUserProfileRepository    (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)              â”‚    â”‚
â”‚  â”‚  â”œâ”€ IChatRoomRepository       (ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ )                    â”‚    â”‚
â”‚  â”‚  â””â”€ IChatMessageRepository    (ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Repository Implementations (repositories/implementations/)       â”‚    â”‚
â”‚  â”‚  â”œâ”€ SupabaseRoomRepository                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ SupabaseGameStateRepository                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ SupabaseUserProfileRepository                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ SupabaseChatRoomRepository                                    â”‚    â”‚
â”‚  â”‚  â””â”€ SupabaseChatMessageRepository                                 â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  ç‰¹å¾´: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å®Ÿè£…ã®åˆ†é›¢ (ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Database Module (database/)                                       â”‚    â”‚
â”‚  â”‚  â””â”€ SupabaseService (Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è²¬ä»»ç¯„å›²**:
- ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒª
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æº
- ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®è©³ç´°ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–

**ä¾å­˜æ€§é€†è»¢ã®ä¾‹**:
```typescript
// Domainå±¤ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ä¾å­˜
class RoomService {
  constructor(
    @Inject('IRoomRepository')
    private roomRepository: IRoomRepository  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
  ) {}
}

// Infrastructureå±¤ã§å®Ÿè£…ã‚’æä¾›
@Module({
  providers: [
    {
      provide: 'IRoomRepository',
      useClass: SupabaseRoomRepository  // å®Ÿè£…
    }
  ]
})
```

### External Services Layer (å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å±¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ğŸ—„ï¸ External Services Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Supabase PostgreSQL                                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ rooms                  (ãƒ«ãƒ¼ãƒ æƒ…å ±)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ room_players           (ãƒ«ãƒ¼ãƒ å‚åŠ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ game_states            (ã‚²ãƒ¼ãƒ çŠ¶æ…‹)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ game_history           (ã‚²ãƒ¼ãƒ å±¥æ­´)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ chat_rooms             (ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ )                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ chat_messages          (ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)                    â”‚    â”‚
â”‚  â”‚  â””â”€ user_profiles          (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— ä¾å­˜é–¢ä¿‚ã®æ–¹å‘ (Clean Architecture æº–æ‹ )

```
å¤–å´ (Infrastructure) â”€â”€â”€â”€â”€â”€â”€â”€â†’ å†…å´ (Domain)
  â†‘                                  â†‘
  â”‚                                  â”‚
  â”‚        ä¾å­˜æ€§ã®é€†è»¢               â”‚
  â”‚     (Dependency Inversion)       â”‚
  â”‚                                  â”‚

Gateways/Controllers
  â”‚
  â””â”€â†’ Use Cases
        â”‚
        â””â”€â†’ Services (Domain Logic)
              â”‚
              â””â”€â†’ Repository Interfaces â†â”
                                         â”‚ å®Ÿè£…
                Repository Implementations â”€â”€â†’ Database
```

### é‡è¦ãªåŸå‰‡

1. **ä¾å­˜æ€§ã®æ–¹å‘**: å†…å´ã®å±¤ã¯å¤–å´ã‚’çŸ¥ã‚‰ãªã„
   - Domainå±¤ã¯Infrastructureå±¤ã‚’çŸ¥ã‚‰ãªã„
   - Serviceså±¤ã¯Gateways/Controllersã‚’çŸ¥ã‚‰ãªã„

2. **ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡** (Dependency Inversion Principle)
   - ä¸Šä½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (Services) ã¯ä¸‹ä½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (Repositories) ã«ä¾å­˜ã—ãªã„
   - ã©ã¡ã‚‰ã‚‚æŠ½è±¡ (Interface) ã«ä¾å­˜ã™ã‚‹

3. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**
   - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ã†ã“ã¨ã§ãƒ¢ãƒƒã‚¯ã¸ã®å·®ã—æ›¿ãˆãŒç°¡å˜
   ```typescript
   Test.createTestingModule({
     providers: [
       RoomService,
       { provide: 'IRoomRepository', useValue: mockRepository }
     ]
   })
   ```

## ğŸ“¡ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ä¾‹: ã‚«ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹

```
Frontend                     Backend                          Database
â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€

1. useGame.playCard('H-A')
     â”‚
     â”œâ”€â†’ socket.emit('play-card', {...})
                                â”‚
                                â–¼
                           2. GameGateway.handlePlayCard()
                                â”‚
                                â”œâ”€â†’ 3. PlayCardUseCase.execute()
                                        â”‚
                                        â”œâ”€â†’ 4. PlayService.playCard()
                                        â”‚     (ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«æ¤œè¨¼)
                                        â”‚
                                        â”œâ”€â†’ 5. RoomService.getRoomGameState()
                                        â”‚     â”‚
                                        â”‚     â””â”€â†’ GameStateRepository.findByRoomId()
                                        â”‚           â”‚
                                        â”‚           â””â”€â†’ Supabase SELECT
                                        â”‚
                                        â””â”€â†’ 6. GameStateRepository.update()
                                                  â”‚
                                                  â””â”€â†’ Supabase UPDATE

                                â–¼
                           7. server.to(roomId).emit('card-played', {...})
     â”‚
     â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8. useGame: 'card-played' ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
     â”‚
     â””â”€â†’ setCurrentField() ã§ReactçŠ¶æ…‹æ›´æ–°
           â”‚
           â””â”€â†’ UIå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

### ãƒ•ãƒ­ãƒ¼è©³ç´°

1. **Frontend**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ `useGame.playCard()` å‘¼ã³å‡ºã—
2. **WebSocketé€ä¿¡**: Socket.IOã§ `play-card` ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
3. **Gateway**: `GameGateway.handlePlayCard()` ãŒã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
4. **Use Case**: `PlayCardUseCase.execute()` ã«å§”è­²
5. **Domain Service**: `PlayService.playCard()` ã§ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
6. **Repository**: `GameStateRepository` ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿æ›¸ã
7. **Database**: Supabaseã«æ°¸ç¶šåŒ–
8. **WebSocketé…ä¿¡**: `server.to(roomId).emit()` ã§ãƒ«ãƒ¼ãƒ å†…å…¨å“¡ã«é…ä¿¡
9. **Frontendæ›´æ–°**: `useGame` ã§ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ â†’ ReactçŠ¶æ…‹æ›´æ–° â†’ UIå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

## ğŸ—ï¸ NestJS Module æ§‹æˆ

```
AppModule (ãƒ«ãƒ¼ãƒˆ)
â”‚
â”œâ”€â”€ ConfigModule.forRoot()      (ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š)
â”œâ”€â”€ ScheduleModule.forRoot()    (ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ - ãƒãƒ£ãƒƒãƒˆå‰Šé™¤)
â”œâ”€â”€ SentryModule.forRoot()      (ã‚¨ãƒ©ãƒ¼ç›£è¦–)
â”‚
â”œâ”€â”€ RepositoriesModule          (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤)
â”‚   â””â”€â”€ DatabaseModule          (SupabaseåˆæœŸåŒ–)
â”‚
â”œâ”€â”€ AuthModule                  (èªè¨¼ãƒ»èªå¯)
â”‚   â””â”€â”€ RepositoriesModule      (å…±æœ‰)
â”‚
â”œâ”€â”€ SocialModule                (ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½)
â”‚   â””â”€â”€ RepositoriesModule      (å…±æœ‰)
â”‚
â””â”€â”€ GameModule                  (ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯)
    â”œâ”€â”€ RepositoriesModule      (å…±æœ‰)
    â”œâ”€â”€ AuthModule              (å…±æœ‰)
    â””â”€â”€ SocialModule            (ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ä½œæˆæ™‚ã«ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã‚‚ä½œæˆ)
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç‰¹æ€§

1. **ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**
   - åŒã˜Moduleã‚’è¤‡æ•°ç®‡æ‰€ã§importã—ã¦ã‚‚ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯1ã¤ã ã‘
   - ä¾‹: `RepositoriesModule` ã¯ `AuthModule`, `SocialModule`, `GameModule` ã§å…±æœ‰

2. **ä¾å­˜æ€§æ³¨å…¥ (DI)**
   - NestJSãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’è‡ªå‹•è§£æ±º
   ```typescript
   @Module({
     providers: [
       { provide: 'IRoomRepository', useClass: SupabaseRoomRepository }
     ],
     exports: ['IRoomRepository']
   })
   ```

3. **forRoot() vs forFeature()**
   - `forRoot()`: AppModuleã§1å›ã ã‘å‘¼ã¶ (ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š)
   - `forFeature()`: å„æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å‘¼ã¶ (ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å›ºæœ‰è¨­å®š)

## ğŸ¯ å±¤ã”ã¨ã®è²¬ä»»ç¯„å›²ã¾ã¨ã‚

| å±¤ | è²¬ä»» | ä¾‹ | ä¾å­˜å…ˆ |
|---|---|---|---|
| **Presentation (Frontend)** | UIè¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› | React Components, Pages | State Management |
| **State Management** | çŠ¶æ…‹ç®¡ç†ã€Socketè³¼èª­ | useGame, useSocket | Communication |
| **Communication** | é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ« | Socket.IO Client, Axios | Backend |
| **Infrastructure (Backend)** | ãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç† | GameGateway, SocialGateway | Use Cases |
| **Application** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ | JoinRoomUseCase, PlayCardUseCase | Services |
| **Domain** | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« | GameStateService, CardService | Repositories |
| **Infrastructure (Data)** | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– | SupabaseRoomRepository | Database |
| **External** | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ | Supabase PostgreSQL | - |

## ğŸ”„ REST vs WebSocket ã®ä½¿ã„åˆ†ã‘

### WebSocketã‚’ä½¿ã†å ´åˆ (Socket.IO)

**é©ç”¨ä¾‹**:
- ã‚²ãƒ¼ãƒ æ“ä½œ (GameGateway)
- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (SocialGateway)
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥

**ç†ç”±**:
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæ–¹å‘é€šä¿¡ãŒå¿…è¦
- å°ã•ã„ãƒ‡ãƒ¼ã‚¿ã®é »ç¹ãªã‚„ã‚Šå–ã‚Š (ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
- ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒå¿…è¦
- æ¥ç¶šç¶­æŒãŒå¿…è¦ (ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ã€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é€šçŸ¥)
- è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ

### RESTã‚’ä½¿ã†å ´åˆ (HTTP API)

**é©ç”¨ä¾‹**:
- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (UserProfileController)

**ç†ç”±**:
- å¤§å®¹é‡ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ (æœ€å¤§2MBç”»åƒ)
- å˜ç™ºæ“ä½œ
- Multipart Form Dataã®ã‚µãƒãƒ¼ãƒˆå¿…è¦
- è¤‡é›‘ãªå‡¦ç† (Sharp.jsç”»åƒæœ€é©åŒ–: 128x128 WebPå¤‰æ›ã€æœ€å¤§50KB)

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [CLAUDE.md](./CLAUDE.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æ¦‚è¦ã¨é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [mei-tra-backend/README.md](./mei-tra-backend/README.md) - NestJSãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°
- [database/schema.sql](./mei-tra-backend/database/schema.sql) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

## ğŸ“ è¨­è¨ˆæ€æƒ³

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™:

1. **Clean Architecture**: å±¤ã®åˆ†é›¢ã¨ä¾å­˜æ€§ã®æ–¹å‘ç®¡ç†
2. **SOLIDåŸå‰‡**: ç‰¹ã«ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ (DIP) ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢ã®åŸå‰‡ (ISP)
3. **ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ (DDD)**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’Domainå±¤ã«é›†ç´„
4. **ä¾å­˜æ€§æ³¨å…¥ (DI)**: NestJSã®DIã‚³ãƒ³ãƒ†ãƒŠã§ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’ç¢ºä¿
5. **Repository Pattern**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã®æŠ½è±¡åŒ–
6. **Use Case Pattern**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–
